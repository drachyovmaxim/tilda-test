function t604_setHeight(recid) {  
  var t604__el=$("#rec"+recid); 
  var t604__image = t604__el.find(".t604__separator");
  t604__image.each(function() {
    var t604__width = $(this).attr("data-slider-image-width");
    var t604__height = $(this).attr("data-slider-image-height"); 
    var t604__ratio = t604__height/t604__width;
    var t604__padding = t604__ratio*100;      
    $(this).css("padding-bottom",t604__padding+"%");    
  });
}




function t_slidesInit(recid) {
  var el = $('#rec'+recid),
      sliderItem = el.find('.t-slides__item'),
      totalSlides = sliderItem.length,
      firstSlide = sliderItem.filter(':first'),
      lastSlide = sliderItem.filter(':last'),
      windowWidth = $(window).width(),
      isPreview = el.find('.t-slides__items-wrapper').attr('data-slider-is-preview'),
      sliderDoResize;

  firstSlide.before(lastSlide.clone(true).attr('data-slide-index', '0')); 
  lastSlide.after(firstSlide.clone(true).attr('data-slide-index', totalSlides+1).removeClass('t-slides__item_active'));
  
  var sliderWrapper = el.find('.t-slides__items-wrapper');
  sliderWrapper.attr('data-slider-totalslides',totalSlides);
  sliderWrapper.attr('data-slider-pos',1);
  sliderWrapper.attr('data-slider-cycle','');
  sliderWrapper.attr('data-slider-animated','');
  var pos = sliderWrapper.attr('data-slider-pos');

  t_slides_SliderWidth(recid);
  t_slides_SliderHeight(recid);
  t_slides_ActiveSlide(recid, pos);
  t_slides_initSliderControls(recid);
  t_slides_ActiveCaption(recid, pos);
  
  if( sliderWrapper.attr('data-slider-timeout') > 0 ){
    t_slides_initAutoPlay(recid);
  }

  if (sliderWrapper.attr('data-slider-arrows-nearpic')=='yes') {
    t_slides_positionArrows(recid);
  }

  if (isPreview !== 'true') {
    t_slides_initSliderSwipe(recid, windowWidth);
  }
  
  el.find('.t-slides').css('visibility', '');

  $(window).resize(function() {
    if (sliderDoResize) clearTimeout(sliderDoResize);
    sliderDoResize = setTimeout(function() {
      t_slides_SliderWidth(recid);
      t_slideMove(recid);
      t_slides_positionArrows(recid)
    }, 200);        
  });
}

function t_slides_initSliderSwipe(recid, windowWidth) {
  var el = $('#rec'+recid);

  delete Hammer.defaults.cssProps.userSelect;
  hammer = new Hammer( el.find('.t-slides__items-wrapper')[ 0 ], {
    domEvents: true,
    threshold: 0,
    direction: Hammer.DIRECTION_VERTICAL,
    inputClass: Hammer.TouchInput
  } );

  hammer.on('pan', function(event){
    var sliderWidth = el.find('.t-slides__container').width(),
        sliderWrapper = el.find('.t-slides__items-wrapper'),
        pos=parseFloat(sliderWrapper.attr('data-slider-pos')),
        totalSlides=parseFloat(sliderWrapper.attr('data-slider-totalslides')),
        cycle='',
        distance = event.deltaX,
        percentage = 100 / totalSlides * event.deltaX / $(window).innerWidth(),
        sensitivity = 20;

    t_slides_scrollImages(recid, (sliderWidth * pos) - distance);

    if( event.isFinal ) {
      if( event.velocityX > 1 ) {
        pos--;
        sliderWrapper.attr('data-slider-pos',pos);
        if(pos==0){
          cycle='yes';
        }
        sliderWrapper.attr('data-slider-cycle',cycle);
        t_slideMove(recid);
      } else if( event.velocityX < -1 ) {
        pos++
        sliderWrapper.attr('data-slider-pos',pos);
        if(pos==(totalSlides+1)){
          cycle='yes';
        }
        sliderWrapper.attr('data-slider-cycle',cycle);
        t_slideMove(recid);
      } else {
        if ( percentage <= -( sensitivity / totalSlides ) ) {
          pos++;
          sliderWrapper.attr('data-slider-pos',pos);
          if(pos==(totalSlides+1)){
            cycle='yes';
          }
          sliderWrapper.attr('data-slider-cycle',cycle);
          t_slideMove(recid);
        } else if ( percentage >= ( sensitivity / totalSlides ) ) {
          pos--;
          sliderWrapper.attr('data-slider-pos',pos);
          if(pos==0){
            cycle='yes';
          }
          sliderWrapper.attr('data-slider-cycle',cycle);
          t_slideMove(recid);
        } else {
          t_slideMove(recid);
        }
      }
    }
  });
}

function t_slides_initSliderControls(recid){
  var el = $('#rec'+recid),
      sliderWrapper = el.find('.t-slides__items-wrapper'),
      sliderWidth = el.find('.t-slides__container').width(),
      sliderTransition = sliderWrapper.attr('data-slider-transition');

  sliderWrapper.css({transform: 'translate3d(-' + (sliderWidth) + 'px, 0, 0)'});

  el.find('.t-slides__arrow_wrapper').click(function(){
    
    var animated=sliderWrapper.attr('data-slider-animated');
    var pos=parseFloat(sliderWrapper.attr('data-slider-pos'));
    var totalSlides=parseFloat(sliderWrapper.attr('data-slider-totalslides'));
    var cycle='';
  
    if (animated=='') {     
      sliderWrapper.attr('data-slider-animated','yes');     
    var direction = $(this).attr('data-slide-direction');
    if(direction==='left'){pos--;}else{pos++;}
      sliderWrapper.attr('data-slider-pos',pos);
      if((pos==(totalSlides+1)) || (pos==0)){
        cycle='yes';
      }
      sliderWrapper.attr('data-slider-cycle',cycle);
      t_slideMove(recid);
    }
  });

  el.find('.t-slides__bullet').click(function(){
    var pos=parseFloat($(this).attr('data-slide-bullet-for'));
    sliderWrapper.attr('data-slider-pos',pos);
    t_slideMove(recid);
  });
}

function t_slideMove(recid) {
  var el = $('#rec'+recid), 
    sliderWrapper = el.find('.t-slides__items-wrapper'),
    sliderWidth = el.find('.t-slides__container').width(),
    sliderTransition = parseFloat(sliderWrapper.attr('data-slider-transition')),    
    animated=sliderWrapper.attr('data-slider-animated'),
    pos=parseFloat(sliderWrapper.attr('data-slider-pos')),
    totalSlides=parseFloat(sliderWrapper.attr('data-slider-totalslides')),
    cycle=sliderWrapper.attr('data-slider-cycle');
    
    sliderWrapper.addClass('t-slides_animated');
    sliderWrapper.css({transform: 'translate3d(-' + (sliderWidth*pos) + 'px, 0, 0)'});

    setTimeout(function(){
      sliderWrapper.removeClass('t-slides_animated');
      sliderWrapper.attr('data-slider-animated','');
      if (cycle=='yes') {
        if (pos==(totalSlides+1)) { pos = 1; };
        if (pos==0) { pos = totalSlides; };
        sliderWrapper.css({transform: 'translate3d(-' + (sliderWidth*pos) + 'px, 0, 0)'});
        sliderWrapper.attr('data-slider-pos',pos);
        t_slides_ActiveBullet(recid, pos);
        t_slides_ActiveSlide(recid, pos);
        t_slides_ActiveCaption(recid, pos);
        if ($('.t-slides__item-loaded').length<totalSlides+2) {
          t_slides_UpdateImages(recid, pos);
          if(window.lazy=='y'){t_lazyload_update();}
        }
      }
      if ($('.t-slides__item-loaded').length<totalSlides+2) {
        if(window.lazy=='y'){t_lazyload_update();}
      }
    }, sliderTransition);

    t_slides_ActiveBullet(recid, pos);
    t_slides_ActiveSlide(recid, pos);
    t_slides_SliderHeight(recid);
    t_slides_ActiveCaption(recid, pos);
    if ($('.t-slides__item-loaded').length<totalSlides+2) {
      t_slides_UpdateImages(recid, pos);
    }
}

function t_slides_UpdateImages(recid, pos) {
  var el = $('#rec'+recid),
      item = el.find('.t-slides__item[data-slide-index="' + pos + '"]');
  item.addClass('t-slides__item-loaded');
  item.nextAll(':lt(2)').addClass('t-slides__item-loaded').prevAll(':lt(2)').addClass('t-slides__item-loaded');
  console.log('no')
  console.log(item)
}

function t_slides_ActiveCaption(recid, pos) {
  var el = $('#rec'+recid),
      caption = el.find('.t-slides__caption'),
      captionActive = el.find('.t-slides__caption[data-slide-caption="' + pos + '"]');
  caption.fadeOut(0);
  captionActive.fadeIn(300);
}

function t_slides_scrollImages(recid, distance) {
  var el = $('#rec'+recid),
      value = (distance < 0 ? "" : "-") + Math.abs(distance).toString();
  el.find(".t-slides__items-wrapper").css("transform", "translate3d(" + value + "px, 0, 0)");
}

function t_slides_ActiveBullet(recid, pos) {
  var el = $('#rec'+recid),
      bullet = el.find('.t-slides__bullet'),
      bulletActive = el.find('.t-slides__bullet[data-slide-bullet-for="' + pos + '"]');
  bullet.removeClass('t-slides__bullet_active');
  bulletActive.addClass('t-slides__bullet_active');
}

function t_slides_ActiveSlide(recid, pos) {
  var el = $('#rec'+recid),
      slide = el.find('.t-slides__item'),
      slideActive = el.find('.t-slides__item[data-slide-index="' + pos + '"]');
  slide.removeClass('t-slides__item_active');
  slideActive.addClass('t-slides__item_active');
}

function t_slides_SliderWidth(recid){
  var el = $('#rec'+recid),
      sliderWidth = el.find('.t-slides__container').width(),
      totalSlides = el.find('.t-slides__item').length;
  el.find('.t-slides__items-wrapper').width(sliderWidth*totalSlides);
  el.find('.t-slides__item').width(sliderWidth);
}

function t_slides_SliderHeight(recid) {
  var el = $('#rec'+recid);
  el.find('.t-slides__items-wrapper').height(el.find('.t-slides__item_active').height());
  el.find('.t-slides__arrow_wrapper').height(el.find('.t-slides__item_active').height());
}

function t_slides_initAutoPlay(recid){
  var el = $('#rec'+recid),
      sliderContainer = el.find('.t-slides'),
      sliderWrapper = el.find('.t-slides__items-wrapper'),
      sliderTimeOut = parseFloat(sliderWrapper.attr('data-slider-timeout'));
  
    sliderContainer.hover(function(e){
      sliderWrapper.attr('data-slider-hovered','yes');  
    }, function(e){
      sliderWrapper.attr('data-slider-hovered','');
    });
  
      setInterval(function(){
        var wst=$(window).scrollTop();
        var wh=$(window).height();
        var eot=el.offset().top;
        var eih=el.innerHeight();
      var hovered=sliderWrapper.attr('data-slider-hovered');
      var ignorehover=sliderWrapper.attr('data-slider-autoplay-ignore-hover');
      
        if( ((wst+wh/2) > eot) && ((eot+eih) > wst) && hovered!='yes' && ignorehover!='yes'){
          el.find('.t-slides__arrow_wrapper-right').trigger('click');
      }
      }, sliderTimeOut);
}

function t_slides_positionArrows(recid){
  var el=$("#rec"+recid);
      container = el.find(".t-slides__arrow_container-outside"),
      inner = el.find(".t-slides__container"),
      arrowleft = el.find(".t-slides__arrow-left"),
      arrowright = el.find(".t-slides__arrow-right");
  container.css({'max-width':(arrowleft.width()+arrowright.width()+inner.width()+ 80 +'px')});
}